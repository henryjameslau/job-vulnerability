<script>
	import { getContext } from 'svelte';
	import { line, curveLinear } from 'd3-shape'

	const { width, height, xScale, yScale, rScale } = getContext('LayerCake');

	export let chartAnnotations = []
	export let strokewidth = 2
	export let stroke = "#206095"
	let size = 100000;

	function lineGenerator(end,start,size){

		var dx = $xScale(end[0])-$xScale(start[0])
		var dy = $yScale(end[1])-$yScale(start[1])
		var theta = Math.atan(dy/dx)
		var radius = $rScale(size)

		var xSign = dx < 0 ? -1 : 1
		var ySign = dx < 0 ? -1 : 1

		return "M " + $xScale(start[0]) +" "+$yScale(start[1])+"m "+(xSign * radius*Math.cos(theta)) + " " + (ySign * radius*Math.sin(theta))+ "L " + $xScale(end[0]) + " "+ $yScale(end[1])
	}

</script>

<g class='annotations'>
	{#each chartAnnotations as d}
		<path class='anno' {stroke} stroke-width={strokewidth} d='M {$xScale(d.x)} {$yScale(d.y)} {lineGenerator([d.dx,d.dy],[d.x,d.y],d.subject.radius)}'></path>
		<circle class='anno' {stroke} stroke-width={strokewidth} r={$rScale(d.subject.radius)} cx={$xScale(d.x)} cy={$yScale(d.y)}></circle>
	{/each}
</g>

<style>
.anno{
	fill:none;
}
</style>
